

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>input_output &mdash; Modulation Instability Module 0.0.1 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Modulation Instability Module
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Header.html">About this module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Usage_example.html">Usage example</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Parameter_inheritance.html">Parameter inheritance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Analysis_tools.html">Analysis tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Behind_the_scenes.html">Behind the scenes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Use_logging_while_running.html">Use logging while running</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Tips_for_working_with_HDF5_files.html">Tips for working with HDF5 files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Requirements.html">Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../BULK_PROCESSING_submodule.html">BULK_PROCESSING submodule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CALIBRATION_submodule.html">CALIBRATION submodule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../FRINGE_EXTRAPOLATION_submodule.html">FRINGE_EXTRAPOLATION submodule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../FTP_submodule.html">FTP submodule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ANALYSIS_submodule.html">ANALYSIS submodule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../VISUALIZATION_submodule.html">VISUALIZATION submodule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../INPUT_OUTPUT_submodule.html">INPUT_OUTPUT submodule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../UTILS_submodule.html">UTILS submodule</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Modulation Instability Module</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Module code</a> &raquo;</li>
        
      <li>input_output</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for input_output</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">h5py</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">skimage.io</span> <span class="k">as</span> <span class="nn">sio</span>
<span class="kn">import</span> <span class="nn">yaml</span>

<span class="kn">import</span> <span class="nn">logging</span>
<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">()</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<div class="viewcode-block" id="create_original_dataset"><a class="viewcode-back" href="../INPUT_OUTPUT_submodule.html#input_output.create_original_dataset">[docs]</a><span class="k">def</span> <span class="nf">create_original_dataset</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">parameter_file</span><span class="p">,</span> <span class="n">cam_calib_path</span><span class="p">,</span> <span class="n">acc_calib_path</span><span class="p">,</span> <span class="n">ftp_path</span><span class="p">,</span> <span class="n">accel_file</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates an original dataset HDF5 file. This function should be used by user instead of generate_original_dataset.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Parse kwargs</span>
    <span class="k">if</span> <span class="s1">&#39;destination_path&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">destination_path</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;destination_path&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">destination_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>

    <span class="c1"># Parse parameter file to determine name of destination file</span>
    <span class="n">name_for_hdf5_file</span> <span class="o">=</span> <span class="n">read_parameter_file</span><span class="p">(</span><span class="n">parameter_file</span><span class="p">)[</span><span class="s1">&#39;DATA_SERIES_NAME&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;-RAW&#39;</span> <span class="o">+</span> <span class="s1">&#39;.hdf5&#39;</span>
    <span class="n">complete_path_and_name_for_hdf5_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">destination_path</span><span class="p">,</span> <span class="n">name_for_hdf5_file</span><span class="p">)</span> 
    <span class="c1"># Generate the dataset</span>
    <span class="n">generate_original_dataset</span><span class="p">(</span><span class="n">complete_path_and_name_for_hdf5_file</span><span class="p">,</span> <span class="n">cam_calib_path</span><span class="p">,</span> <span class="n">acc_calib_path</span><span class="p">,</span> <span class="n">ftp_path</span><span class="p">,</span> <span class="n">accel_file</span><span class="p">,</span> <span class="n">parameter_file</span><span class="p">,</span> <span class="n">logging_level</span><span class="o">=</span><span class="n">logging_level</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="generate_original_dataset"><a class="viewcode-back" href="../INPUT_OUTPUT_submodule.html#input_output.generate_original_dataset">[docs]</a><span class="k">def</span> <span class="nf">generate_original_dataset</span><span class="p">(</span><span class="n">hdf5_datasetname</span><span class="p">,</span> <span class="n">cam_calib_path</span><span class="p">,</span> <span class="n">acc_calib_path</span><span class="p">,</span> <span class="n">ftp_im_path</span><span class="p">,</span> <span class="n">accel_file</span><span class="p">,</span> <span class="n">parameter_file</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates an original dataset HDF5 file according to the following scheme.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># HDF5 file creation</span>
    <span class="n">hdf5_file</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">hdf5_datasetname</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>

    <span class="c1"># Read capture_parameters.yaml file</span>
    <span class="n">parameters</span> <span class="o">=</span> <span class="n">read_parameter_file</span><span class="p">(</span><span class="n">parameter_file</span><span class="p">)</span>

    <span class="c1"># Assign image size</span>
    <span class="n">Slin</span><span class="p">,</span> <span class="n">Scol</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;CAMERA_CAPTURE&#39;</span><span class="p">][</span><span class="s1">&#39;shape&#39;</span><span class="p">]</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Creando el dataset de la camara...&#39;</span><span class="p">)</span>
    <span class="c1"># Creation of calibration_camera group</span>
    <span class="c1"># If cam_calib_path is an actual path, then store individual images in a dataset</span>
    <span class="c1"># If cam_calib_path is a file (a HDF5 file), then grab calibration results from it</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">cam_calib_path</span><span class="p">):</span>
        <span class="n">cal_files</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cam_calib_path</span><span class="p">,</span> <span class="s1">&#39;*.tif&#39;</span><span class="p">)))</span>
        <span class="n">Ncal</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cal_files</span><span class="p">)</span>
        <span class="n">cal_dset</span> <span class="o">=</span> <span class="n">hdf5_file</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;calibration_camera&#39;</span><span class="p">,</span> \
                <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">Slin</span><span class="p">,</span> <span class="n">Scol</span><span class="p">,</span> <span class="n">Ncal</span><span class="p">),</span> <span class="n">chunks</span><span class="o">=</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="n">Ncal</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>

        <span class="n">ii</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">cal_files</span><span class="p">:</span>
            <span class="n">image</span> <span class="o">=</span> <span class="n">sio</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
            <span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
            <span class="n">cal_dset</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="n">image</span>
            <span class="n">ii</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">cam_calib_path</span><span class="p">):</span>
        <span class="c1"># grab camera calibration results from file</span>
        <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span> 
        <span class="k">pass</span>


    <span class="n">hdf5_file</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
    
    <span class="c1"># Creation of ftp_images group</span>
    <span class="n">ftp_grp</span> <span class="o">=</span> <span class="n">hdf5_file</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s1">&#39;ftp_images&#39;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Creando dataset de grises&#39;</span><span class="p">)</span>
    <span class="c1"># Create gray dataset</span>
    <span class="n">gri_files</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ftp_im_path</span><span class="p">,</span> <span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="s1">&#39;*.tif&#39;</span><span class="p">)))</span>
    <span class="n">Ngri</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">gri_files</span><span class="p">)</span>
    <span class="n">N_gri_vertical_slices</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">Ngri</span><span class="o">/</span><span class="mi">100</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">Ngri</span><span class="o">/</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">is_integer</span><span class="p">()</span> <span class="p">)</span>
    <span class="n">gri_dset</span> <span class="o">=</span> <span class="n">hdf5_file</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;ftp_images/gray&#39;</span><span class="p">,</span> \
            <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">Slin</span><span class="p">,</span> <span class="n">Scol</span><span class="p">,</span> <span class="n">Ngri</span><span class="p">),</span> <span class="n">chunks</span><span class="o">=</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="n">N_gri_vertical_slices</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>
    <span class="n">kk</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">acum_gri</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Slin</span><span class="p">,</span> <span class="n">Scol</span><span class="p">,</span> <span class="n">N_gri_vertical_slices</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">Ngri</span><span class="o">/</span><span class="n">N_gri_vertical_slices</span><span class="p">)):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N_gri_vertical_slices</span><span class="p">):</span>
            <span class="n">image</span> <span class="o">=</span> <span class="n">sio</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">gri_files</span><span class="p">[</span><span class="n">kk</span><span class="p">])</span>
            <span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
            <span class="n">acum_gri</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">image</span> 
            <span class="n">kk</span> <span class="o">+=</span> <span class="mi">1</span>
            
        <span class="n">gri_dset</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">((</span><span class="n">N_gri_vertical_slices</span><span class="o">*</span><span class="n">j</span><span class="p">)):(</span><span class="n">N_gri_vertical_slices</span><span class="o">*</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">))]</span> <span class="o">=</span> <span class="n">acum_gri</span> 
    
    <span class="n">hdf5_file</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
    
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Creando dataset de referencia&#39;</span><span class="p">)</span>
    <span class="c1"># Create reference dataset</span>
    <span class="n">ref_files</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ftp_im_path</span> <span class="p">,</span> <span class="s1">&#39;reference&#39;</span><span class="p">,</span> <span class="s1">&#39;*.tif&#39;</span><span class="p">)))</span>
    <span class="n">Nref</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ref_files</span><span class="p">)</span>
    <span class="n">N_ref_vertical_slices</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">Nref</span><span class="o">/</span><span class="mi">100</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">Nref</span><span class="o">/</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">is_integer</span><span class="p">()</span> <span class="p">)</span>
    <span class="n">ref_dset</span> <span class="o">=</span> <span class="n">hdf5_file</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;ftp_images/reference&#39;</span><span class="p">,</span> \
            <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">Scol</span><span class="p">,</span> <span class="n">Slin</span><span class="p">,</span> <span class="n">Nref</span><span class="p">),</span> <span class="n">chunks</span><span class="o">=</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="n">N_ref_vertical_slices</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>
    <span class="n">kk</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">acum_ref</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Slin</span><span class="p">,</span> <span class="n">Scol</span><span class="p">,</span> <span class="n">N_ref_vertical_slices</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">Nref</span><span class="o">/</span><span class="n">N_ref_vertical_slices</span><span class="p">)):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N_ref_vertical_slices</span><span class="p">):</span>
            <span class="n">image</span> <span class="o">=</span> <span class="n">sio</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">ref_files</span><span class="p">[</span><span class="n">kk</span><span class="p">])</span>
            <span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
            <span class="n">acum_ref</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">image</span> 
            <span class="n">kk</span> <span class="o">+=</span> <span class="mi">1</span>
            
        <span class="n">ref_dset</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">((</span><span class="n">N_ref_vertical_slices</span><span class="o">*</span><span class="n">j</span><span class="p">)):(</span><span class="n">N_ref_vertical_slices</span><span class="o">*</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">))]</span> <span class="o">=</span> <span class="n">acum_ref</span> 
    
    <span class="n">hdf5_file</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
    
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Creando dataset deformadas&#39;</span><span class="p">)</span>
    <span class="c1"># Create deformed dataset</span>
    <span class="n">def_files</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ftp_im_path</span> <span class="p">,</span> <span class="s1">&#39;deformed&#39;</span><span class="p">,</span> <span class="s1">&#39;*.tif&#39;</span><span class="p">)))</span>
    <span class="n">Ndef</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">def_files</span><span class="p">)</span>

    <span class="n">N_vertical_slices</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">Ndef</span><span class="o">/</span><span class="mi">100</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">Ndef</span><span class="o">/</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">is_integer</span><span class="p">()</span> <span class="p">)</span>
    
    <span class="n">def_dset</span> <span class="o">=</span> <span class="n">hdf5_file</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;ftp_images/deformed&#39;</span><span class="p">,</span> \
            <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">Slin</span><span class="p">,</span> <span class="n">Scol</span><span class="p">,</span> <span class="n">Ndef</span><span class="p">),</span> <span class="n">chunks</span><span class="o">=</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="n">N_vertical_slices</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>

    <span class="n">kk</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">acum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Slin</span><span class="p">,</span> <span class="n">Scol</span><span class="p">,</span> <span class="n">N_vertical_slices</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">Ndef</span><span class="o">/</span><span class="n">N_vertical_slices</span><span class="p">)):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N_vertical_slices</span><span class="p">):</span>
            <span class="n">image</span> <span class="o">=</span> <span class="n">sio</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">def_files</span><span class="p">[</span><span class="n">kk</span><span class="p">])</span>
            <span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
            <span class="n">acum</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">image</span> 
            <span class="n">kk</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">def_dset</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">((</span><span class="n">N_vertical_slices</span><span class="o">*</span><span class="n">j</span><span class="p">)):(</span><span class="n">N_vertical_slices</span><span class="o">*</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">))]</span> <span class="o">=</span> <span class="n">acum</span> 
    
    <span class="n">hdf5_file</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Listo.&#39;</span><span class="p">)</span>

    <span class="c1"># accelerometer_readings_dset = hdf5_file.create_dataset(&#39;raw_accelerometer_readings&#39;)</span>

    <span class="c1"># Creation of calibration_accelerometer group</span>
    <span class="c1"># If acc_calib_path is an actual path, then store individual images in a dataset</span>
    <span class="c1"># If acc_calib_path is a file (a HDF5 file), then grab calibration results from it</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">acc_calib_path</span><span class="p">):</span>
        <span class="c1"># Store accelerometer readings</span>
        <span class="c1"># which contains the accelerometer_readings as a numpy array with </span>
        <span class="c1"># 4 columns (time, acc_x, acc_y, acc_z), and as many rows as readings</span>
        <span class="k">pass</span>
    <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">acc_calib_path</span><span class="p">):</span>
        <span class="c1"># Grab accelerometer calibration results from HDF5 file</span>
        <span class="k">pass</span>


    <span class="n">hdf5_file</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
    

    <span class="c1"># Storing the capture_parameters dataset as attributes to each dataset</span>
    <span class="c1"># Data series name, forcing type, forcing &amp; modulating frequencies + comments</span>
    <span class="n">hdf5_file</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;data_series_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;DATA_SERIES_NAME&#39;</span><span class="p">]</span>
    <span class="n">hdf5_file</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;FORCING&#39;</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span>
    <span class="n">hdf5_file</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;osc_freq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;FORCING&#39;</span><span class="p">][</span><span class="s1">&#39;osc_freq&#39;</span><span class="p">]</span>
    <span class="n">hdf5_file</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;mod_freq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;FORCING&#39;</span><span class="p">][</span><span class="s1">&#39;mod_freq&#39;</span><span class="p">]</span>
    <span class="n">hdf5_file</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;comments&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;COMMENTS&#39;</span><span class="p">]</span>
    <span class="c1"># Camera calibration parameters</span>
    <span class="n">cal_dset</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;corners&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;CAMERA_CALIBRATION&#39;</span><span class="p">][</span><span class="s1">&#39;corners&#39;</span><span class="p">]</span>
    <span class="n">cal_dset</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;square_size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;CAMERA_CALIBRATION&#39;</span><span class="p">][</span><span class="s1">&#39;square_size&#39;</span><span class="p">]</span>
    <span class="n">cal_dset</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;CAMERA_CALIBRATION&#39;</span><span class="p">][</span><span class="s1">&#39;units&#39;</span><span class="p">]</span>
    <span class="c1"># FTP Projection parameters</span>
    <span class="n">ftp_grp</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;FTP_PROJECTION&#39;</span><span class="p">][</span><span class="s1">&#39;L&#39;</span><span class="p">]</span>
    <span class="n">ftp_grp</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;D&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;FTP_PROJECTION&#39;</span><span class="p">][</span><span class="s1">&#39;D&#39;</span><span class="p">]</span>
    <span class="n">ftp_grp</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;pspp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;FTP_PROJECTION&#39;</span><span class="p">][</span><span class="s1">&#39;pspp&#39;</span><span class="p">]</span>
    <span class="n">ftp_grp</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;FTP_PROJECTION&#39;</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span>
    <span class="n">ftp_grp</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;FTP_PROJECTION&#39;</span><span class="p">][</span><span class="s1">&#39;units&#39;</span><span class="p">]</span>
    <span class="c1"># Camera capture parameters</span>
    <span class="n">ftp_grp</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;shape&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;CAMERA_CAPTURE&#39;</span><span class="p">][</span><span class="s1">&#39;shape&#39;</span><span class="p">]</span>
    <span class="n">ftp_grp</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;camera_freq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;CAMERA_CAPTURE&#39;</span><span class="p">][</span><span class="s1">&#39;freq&#39;</span><span class="p">]</span>
    <span class="n">ftp_grp</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;N_images&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;CAMERA_CAPTURE&#39;</span><span class="p">][</span><span class="s1">&#39;N_images&#39;</span><span class="p">]</span>
    <span class="c1"># Accelerometer parameters</span>
    <span class="n">ftp_grp</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;accelerometer_freq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;ACCELEROMETER_CAPTURE&#39;</span><span class="p">][</span><span class="s1">&#39;freq&#39;</span><span class="p">]</span>

    <span class="n">hdf5_file</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

    <span class="n">hdf5_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>


<div class="viewcode-block" id="read_parameter_file"><a class="viewcode-back" href="../INPUT_OUTPUT_submodule.html#input_output.read_parameter_file">[docs]</a><span class="k">def</span> <span class="nf">read_parameter_file</span><span class="p">(</span><span class="n">yamlfile</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads a YAML parameter file, returning it as a dictionary.&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">yamlfile</span><span class="p">))</span></div>


<div class="viewcode-block" id="create_empty_parameter_file"><a class="viewcode-back" href="../INPUT_OUTPUT_submodule.html#input_output.create_empty_parameter_file">[docs]</a><span class="k">def</span> <span class="nf">create_empty_parameter_file</span><span class="p">(</span><span class="n">path_for_file</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates empty parameter file to accompany an original dataset. </span>
<span class="sd">    &quot;&quot;&quot;</span></div>

</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Pablo Cobelli.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.0.1',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>